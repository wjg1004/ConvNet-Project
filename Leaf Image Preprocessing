Link: http://learnandshare645.blogspot.com/2016/06/feeding-your-own-data-set-into-cnn.html

from keras.models import Sequential
from keras.layers.core import Dense, Dropout, Activation, Flatten
from keras.layers.convolutional import Convolution2D, MaxPooling2D
from keras.optimizers import SGD,RMSprop,adam
from keras.utils import np_utils

import numpy as np
import matplotlib.pyplot as plt
import matplotlib
import os
import tensorflow
from PIL import Image
from numpy import *

from sklearn.utils import shuffle
from sklearn.cross_validation import train_test_split

import skimage
from skimage import io
import os

path1 = 'C:\\Users\\wgeit\\Documents\\Leafsnap Data\\dataset\\acer_campestre'
listing = os.listdir(path1)
num_samples=size(listing)
print (num_samples)

im1 = array(Image.open(path1 + '\\'+ listing[0])) # open one image to get size
m,n = im1.shape[0:2] # get the size of the images
imnbr = len(listing) # get the number of images


##### determine average dimensions of all images #####

s1=0
ns1=0
s2=0
ns2=0
for leaf_folder in list_leaves:
    temp_list = os.listdir(all_leaves_path + '\\' + leaf_folder)
    for leaf_image in temp_list:
        s1 = s1 + shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[0]
        ns1 = ns1 + 1
        s2 = s2 + shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[1]
        ns2 = ns2 + 1
print(s1/ns1,s2/ns2)

##### determine smallest dimensions in the dataset ##### 

s1=1000
s2=1000
for leaf_folder in list_leaves:
    temp_list = os.listdir(all_leaves_path + '\\' + leaf_folder)
    for leaf_image in temp_list:
        if s1 > shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[0]:
            s1 = shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[0]
        if s2 > shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[1]:
            s2 = shape(imread(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image))[1]

##### put all images into one file and create an array for the corresponding labels #####

new_folder = 'C:\\Users\\Berg\\Desktop\\Leaves' 
all_leaves_path = 'C:\\Users\\Berg\\Desktop\\lab'
list_leaves = os.listdir(all_leaves_path)
num_leaf_types = size(list_leaves)
labels = []

for leaf_folder in list_leaves:
    temp_list = os.listdir(all_leaves_path + '\\' + leaf_folder)
    for leaf_image in temp_list:
        im = Image.open(all_leaves_path + '\\' + leaf_folder + '\\' + leaf_image)
        im.save(new_folder + '\\' + leaf_image, "JPEG")
        labels.append(leaf_folder)


##### flatten the images and fit all of them into one array #####

imlist = os.listdir(new_folder)
immatrix = array([((imread(new_folder + '\\' + imlist[0]))).flatten()])
shape(immatrix)
del imlist[0]
for image in imlist:
        immatrix = vstack((immatrix,array([(imread(new_folder + '\\' + image)).flatten()])))


